'use strict';

function YouTubeID(url) {
    return new Promise((resolve, _) => {
        if (/youtu\.?be/.test(url)) {
            var i;
            var patterns = [
                /youtu\.be\/([^#\&\?]{11})/,
                /\?v=([^#\&\?]{11})/,
                /\&v=([^#\&\?]{11})/,
                /embed\/([^#\&\?]{11})/,
                /\/v\/([^#\&\?]{11})/,
                /list=([^#\&\?]+)/,
                /playlist\?list=([^#\&\?]+)/,
            ];
            for (i = 0; i < patterns.length; ++i) {
                if (patterns[i].test(url)) {
                    if (i === patterns.length - 1) {
                        const match = patterns[i].exec(url);
                        const playlistParams = new URLSearchParams(match[0]);
                        const videoId = playlistParams.get("v");
                        return resolve(videoId);
                    }
                    else
                        return resolve(patterns[i].exec(url)[1]);
                }
            }
        }
        resolve(null);
    });
}

module.exports = YouTubeID;
